<form action="{?=url(ADMIN.'/utd/savependonor')?}" method="POST">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title">
              Data Aset
            </h3>
            <ul class="nav nav-tabs">
                <li class="active">
                    <a href="{?=url([ADMIN,'utd','pendonor'])?}" role="tab">Data Pendonor</a>
                </li>
                <li>
                    <a href="{?=url([ADMIN,'utd','donor'])?}" role="tab">Data Donor</a>
                </li>
                <li>
                    <a href="{?=url([ADMIN,'utd','stokdarah'])?}" role="tab">Stok Darah</a>
                </li>
            </ul>
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-md-6">
                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                            <label>Nomor Pendonor</label>
                            <input type="text" name="no_pendonor" class="form-control" value="{$nomor}" required />
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group">
                            <label>Nama Pendonor</label>
                            <input type="text" name="nama" class="form-control" value="" required />
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                            <label>Nomor KTP</label>
                            <input type="text" name="no_ktp" class="form-control" value="" required />
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group">
                            <label>Nomor Telepon</label>
                            <input type="text" name="no_telp" class="form-control" value="" required />
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                            <label>Tempat Lahir</label>
                            <input type="text" name="tmp_lahir" class="form-control" value="" required />
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group">
                            <label>Tanggal Lahir</label>
                            <input type="text" name="tgl_lahir" id="tgl_lahir" class="form-control tanggal" value="" required />
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-4">
                        <div class="form-group">
                            <label>Jenis Kelamin</label>
                            <select name="jk" id="jk" class="form-control" data-use-search="true">
                                <option value="L">Laki-Laki</option>
                                <option value="P">Perempuan</option>
                            </select>
                        </div>
                      </div>
                      <div class="col-md-4">
                        <div class="form-group">
                            <label>Golongan Darah</label>
                            <select name="golongan_darah" id="golongan_darah" class="form-control" data-use-search="true">
                              <option value="O">O</option>
                              <option value="A">A</option>
                              <option value="B">B</option>
                              <option value="AB">AB</option>
                            </select>
                        </div>
                      </div>
                      <div class="col-md-4">
                        <div class="form-group">
                            <label>Resus</label>
                            <select name="resus" id="resus" class="form-control" data-use-search="true">
                              <option value="(+)">Positif</option>
                              <option value="(-)">Negatif</option>
                            </select>
                        </div>
                      </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label>Alamat</label>
                        <textarea name="alamat" class="form-control" rows="5" cols="80"></textarea>
                    </div>
                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                            <label>Propinsi</label>
                            <input type="text" name="nm_prop" id="nm_prop" class="form-control" value="" />
                            <input type="hidden" name="kd_prop" id="kd_prop" class="form-control" value="" />
                            <ul class="list-group" id="propinsiList" style="z-index:1000;position:absolute;width:100%;"></ul>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group">
                            <label>Kabupaten/Kota</label>
                            <input type="text" name="nm_kab" id="nm_kab" class="form-control" value="" />
                            <input type="hidden" name="kd_kab" id="kd_kab" class="form-control" value="" />
                            <ul class="list-group" id="kabupatenList" style="z-index:1000;position:absolute;width:100%;"></ul>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6">
                        <div class="form-group">
                            <label>Kecamatan</label>
                            <input type="text" name="nm_kec" id="nm_kec" class="form-control" value="" />
                            <input type="hidden" name="kd_kec" id="kd_kec" class="form-control" value="" />
                            <ul class="list-group" id="kecamatanList" style="z-index:1000;position:absolute;width:100%;"></ul>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-group">
                            <label>Kelurahan</label>
                            <input type="text" name="nm_kel" id="nm_kel" class="form-control" value="" />
                            <input type="hidden" name="kd_kel" id="kd_kel" class="form-control" value="" />
                            <ul class="list-group" id="kelurahanList" style="z-index:1000;position:absolute;width:100%;"></ul>
                        </div>
                      </div>
                    </div>
                </div>
                <div class="col-md-12" style="padding-top: 20px;">
                    <input type="submit" name="simpan" class="btn btn-success" value="Simpan" />
                    <input type="submit" name="update" class="btn btn-info" value="Update" />
                    <input type="submit" name="hapus" id="hapus" class="btn btn-danger pull-right" value="Hapus" />
                </div>
            </div>
        </div>
    </div>
</form>

<div class="row">
  <div class="col-md-12">
    <div class="table-responsive no-margin" id="utd_pendonor">
      <table class="table table-striped table-bordered no-padding nowrap dataTables" width="100%">
        <thead>
          <tr>
            <th>No. Pendonor</th>
            <th>Nama Pendonor</th>
            <th>Nomor KTP</th>
            <th>Jenis Kelamin</th>
            <th>Gol. Darah</th>
            <th>Resus</th>
            <th>Tempat Lahir</th>
            <th>Tanggal Lahir</th>
            <th>Alamat</th>
            <th>Kelurahan</th>
            <th>Kecamatan</th>
            <th>Kabupaten/Kota</th>
            <th>Propinsi</th>
            <th>Telepon</th>
          </tr>
        </thead>
        <tbody>
          {if: $pendonor}
          {loop: $pendonor}
          <tr class="utd_pendonor"
          data-no_pendonor="{$value.no_pendonor}"
          data-nama="{$value.nama}"
          data-no_ktp="{$value.no_ktp}"
          data-jk="{$value.jk}"
          data-tmp_lahir="{$value.tmp_lahir}"
          data-tgl_lahir="{$value.tgl_lahir}"
          data-alamat="{$value.alamat}"
          data-kd_kel="{$value.kd_kel}"
          data-nm_kel="{$value.nm_kel}"
          data-kd_kec="{$value.kd_kec}"
          data-nm_kec="{$value.nm_kec}"
          data-kd_kab="{$value.kd_kab}"
          data-nm_kab="{$value.nm_kab}"
          data-kd_prop="{$value.kd_prop}"
          data-nm_prop="{$value.nm_prop}"
          data-golongan_darah="{$value.golongan_darah}"
          data-resus="{$value.resus}"
          data-no_telp="{$value.no_telp}"
          >
            <td>{$value.no_pendonor}</td>
            <td>{$value.nama}</td>
            <td>{$value.no_ktp}</td>
            <td>{if: $value.jk == 'L'}Laki-Laki{else}Perempuan{/if}</td>
            <td>{$value.golongan_darah}</td>
            <td>{$value.resus}</td>
            <td>{$value.tmp_lahir}</td>
            <td>{$value.tgl_lahir}</td>
            <td>{$value.alamat}</td>
            <td>{$value.kd_kel} - {$value.nm_kel}</td>
            <td>{$value.kd_kec} - {$value.nm_kec}</td>
            <td>{$value.kd_kab} - {$value.nm_kab}</td>
            <td>{$value.kd_prop} - {$value.nm_prop}</td>
            <td>{$value.no_telp}</td>
          </tr>
          {/loop}
          {/if}
        </tbody>
      </table>
    </div>
  </div>
</div>

<script type="text/javascript">
  $("#utd_pendonor").on("click", ".utd_pendonor", function(event){
    var no_pendonor  = $(this).attr("data-no_pendonor");
    var nama  = $(this).attr("data-nama");
    var no_ktp  = $(this).attr("data-no_ktp");
    var jk  = $(this).attr("data-jk");
    var golongan_darah  = $(this).attr("data-golongan_darah");
    var resus  = $(this).attr("data-resus");
    var tmp_lahir  = $(this).attr("data-tmp_lahir");
    var tgl_lahir  = $(this).attr("data-tgl_lahir");
    var alamat  = $(this).attr("data-alamat");
    var kd_kel  = $(this).attr("data-kd_kel");
    var nm_kel  = $(this).attr("data-nm_kel");
    var kd_kec  = $(this).attr("data-kd_kec");
    var nm_kec  = $(this).attr("data-nm_kec");
    var kd_kab  = $(this).attr("data-kd_kab");
    var nm_kab  = $(this).attr("data-nm_kab");
    var kd_prop  = $(this).attr("data-kd_prop");
    var nm_prop  = $(this).attr("data-nm_prop");
    var no_telp  = $(this).attr("data-no_telp");
    $('input:text[name=no_pendonor]').val(no_pendonor);
    $('input:text[name=nama]').val(nama);
    $('input:text[name=no_ktp]').val(no_ktp);
    $('#jk').val(jk).change();
    $('#golongan_darah').val(golongan_darah).change();
    $('#resus').val(resus).change();
    $('input:text[name=tmp_lahir]').val(tmp_lahir);
    $('#tgl_lahir').val(tgl_lahir);
    $('textarea[name=alamat]').val(alamat);
    $('#kd_kel').val(kd_kel);
    $('#nm_kel').val(nm_kel);
    $('#kd_kec').val(kd_kec);
    $('#nm_kec').val(nm_kec);
    $('#kd_kab').val(kd_kab);
    $('#nm_kab').val(nm_kab);
    $('#kd_prop').val(kd_prop);
    $('#nm_prop').val(nm_prop);
    $('input:text[name=no_telp]').val(no_telp);
    $('input:text[name=no_pendonor]').prop('readonly', true);
  });
</script>
<script>
  $('#nm_prop').keyup(function(){
     event.preventDefault();
     var query = $(this).val();
     if(query != '')
     {
        $.ajax({
           url: "{?=url([ADMIN, 'utd', 'wilayah?show=caripropinsi'])?}",
           method:"POST",
           data:{query:query},
           success:function(data)
           {
              $('#propinsiList').fadeIn();
              $('#propinsiList').html(data);
           }
        });
     }
  });
  $('#propinsiList').on('click', 'li', function(){
     $('#nm_prop').val($(this).text().split(': ')[1]);
     $('#kd_prop').val($(this).text().split(': ')[0]);
     $('#propinsiList').fadeOut();
  });
  $('#nm_kab').keyup(function(){
     event.preventDefault();
     var query = $(this).val();
     if(query != '')
     {
        $.ajax({
           url: "{?=url([ADMIN, 'utd', 'wilayah?show=carikabupaten'])?}",
           method:"POST",
           data:{query:query},
           success:function(data)
           {
              $('#kabupatenList').fadeIn();
              $('#kabupatenList').html(data);
           }
        });
     }
  });
  $('#kabupatenList').on('click', 'li', function(){
       $('#nm_kab').val($(this).text().split(': ')[1]);
       $('#kd_kab').val($(this).text().split(': ')[0]);
       $('#kabupatenList').fadeOut();
  });
  $('#nm_kec').keyup(function(){
       event.preventDefault();
       var query = $(this).val();
       if(query != '')
       {
            $.ajax({
                 url: "{?=url([ADMIN, 'utd', 'wilayah?show=carikecamatan'])?}",
                 method:"POST",
                 data:{query:query},
                 success:function(data)
                 {
                      $('#kecamatanList').fadeIn();
                      $('#kecamatanList').html(data);
                 }
            });
       }
  });
  $('#kecamatanList').on('click', 'li', function(){
       $('#nm_kec').val($(this).text().split(': ')[1]);
       $('#kd_kec').val($(this).text().split(': ')[0]);
       $('#kecamatanList').fadeOut();
  });
  $('#nm_kel').keyup(function(){
       event.preventDefault();
       var query = $(this).val();
       if(query != '')
       {
            $.ajax({
                 url: "{?=url([ADMIN, 'utd', 'wilayah?show=carikelurahan'])?}",
                 method:"POST",
                 data:{query:query},
                 success:function(data)
                 {
                      $('#kelurahanList').fadeIn();
                      $('#kelurahanList').html(data);
                 }
            });
       }
  });
  $('#kelurahanList').on('click', 'li', function(){
       $('#nm_kel').val($(this).text().split(': ')[1]);
       $('#kd_kel').val($(this).text().split(': ')[0]);
       $('#kelurahanList').fadeOut();
  });

  $(function() {
    $("form").on("click", "#hapus", function(event){
      var baseURL = mlite.url + '/' + mlite.admin;
      var no_pendonor = $('input:text[name=no_pendonor]').val();
      event.preventDefault();
      if(no_pendonor == '') {
        alert('Silahkan pilih data yang mau dihapus!!');
      } else {
        $.confirm({
          columnClass: 'col-md-4 col-md-offset-4',
          theme: 'white',
          title: 'Peringatan',
          text: 'Apakah anda yakin akan menghapus data ini?',
          confirmButton: 'Iya',
          cancelButton: 'Tidak',
          confirmButtonClass: 'btn-success',
          cancelButtonClass: 'btn-danger',
          confirm: function() {
            window.location.replace(baseURL + '/utd/hapuspendonor/' + no_pendonor + '?t=' + mlite.token);
          },
          cancel: function() {
          }
        });
      }
    });
  });

 </script>
